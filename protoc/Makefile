ALPINE_VERSION ?= 3.8
GO_VERSION = 1.11.5
GRPC_GATEWAY_VERSION ?= 1.7.0
GRPC_JAVA_VERSION ?= 1.18.0
GRPC_RUST_VERSION ?= 0.6.1
GRPC_SWIFT_VERSION ?= 0.7.0
GRPC_VERSION ?= 1.19.0
GRPC_WEB_VERSION ?= 1.0.3
PROTOBUF_C_VERSION ?= 1.3.1
PROTOC_GEN_DOC_VERSION ?= 1.1.0
PROTOC_GEN_FIELDMASK_VERSION ?= 0.1.0
PROTOC_GEN_GO_VERSION ?= 1.3.0
PROTOC_GEN_GOGO_VERSION ?= 1.2.1
PROTOC_GEN_GOGOTTN_VERSION ?= 3.0.11
PROTOC_GEN_GOVALIDATORS_VERSION ?= 1f388280e944c97cc59c75d8c84a704097d1f1d6
PROTOC_GEN_LINT_VERSION ?= 0.2.1
PROTOC_GEN_VALIDATE_VERSION ?= 0.0.13
RUST_PROTOBUF_VERSION ?= 2.2.5
RUST_VERSION ?= 1.32.0
SWIFT_VERSION ?= 4.2.2
JS_GOOGLE_PROTOBUF_VERSION ?= 3.7.0-rc.3
TS_PROTOC_GEN_VERSION ?= 0.9.0
UPX_VERSION ?= 3.95

IMAGE_NAME ?= shiwano/protoc
TAG ?= latest

.PHONY: all
all: build

.PHONY: build
build:
	docker build \
	--build-arg ALPINE_VERSION=$(ALPINE_VERSION) \
	--build-arg GO_VERSION=$(GO_VERSION) \
	--build-arg GRPC_GATEWAY_VERSION=$(GRPC_GATEWAY_VERSION) \
	--build-arg GRPC_JAVA_VERSION=$(GRPC_JAVA_VERSION) \
	--build-arg GRPC_RUST_VERSION=$(GRPC_RUST_VERSION) \
	--build-arg GRPC_SWIFT_VERSION=$(GRPC_SWIFT_VERSION) \
	--build-arg GRPC_VERSION=$(GRPC_VERSION) \
	--build-arg GRPC_WEB_VERSION=$(GRPC_WEB_VERSION) \
	--build-arg PROTOBUF_C_VERSION=$(PROTOBUF_C_VERSION) \
	--build-arg PROTOC_GEN_DOC_VERSION=$(PROTOC_GEN_DOC_VERSION) \
	--build-arg PROTOC_GEN_FIELDMASK_VERSION=$(PROTOC_GEN_FIELDMASK_VERSION) \
	--build-arg PROTOC_GEN_GO_VERSION=$(PROTOC_GEN_GO_VERSION) \
	--build-arg PROTOC_GEN_GOGO_VERSION=$(PROTOC_GEN_GOGO_VERSION) \
	--build-arg PROTOC_GEN_GOGOTTN_VERSION=$(PROTOC_GEN_GOGOTTN_VERSION) \
	--build-arg PROTOC_GEN_GOVALIDATORS_VERSION=$(PROTOC_GEN_GOVALIDATORS_VERSION) \
	--build-arg PROTOC_GEN_LINT_VERSION=$(PROTOC_GEN_LINT_VERSION) \
	--build-arg PROTOC_GEN_VALIDATE_VERSION=$(PROTOC_GEN_VALIDATE_VERSION) \
	--build-arg RUST_PROTOBUF_VERSION=$(RUST_PROTOBUF_VERSION) \
	--build-arg RUST_VERSION=$(RUST_VERSION) \
	--build-arg SWIFT_VERSION=$(SWIFT_VERSION) \
	--build-arg JS_GOOGLE_PROTOBUF_VERSION=$(JS_GOOGLE_PROTOBUF_VERSION) \
	--build-arg TS_PROTOC_GEN_VERSION=$(TS_PROTOC_GEN_VERSION) \
	--build-arg UPX_VERSION=$(UPX_VERSION) \
	-t $(IMAGE_NAME):$(TAG) .

.PHONY: push
push: build
	docker push $(IMAGE_NAME):$(TAG)

.PHONY: clean
clean:
	rm -rf build
